<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic English A - Unit 1: Multiple Choice Section B</title>
<link rel="stylesheet" href="../../../style.css">
<style>
body { font-family: "Segoe UI", Arial, sans-serif; padding:18px; background:linear-gradient(#f6f8fb,#ffffff); color:#111; }
.container { max-width:920px; margin:0 auto; background:rgba(255,255,255,0.95); padding:18px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06); }
h1 { text-align:center; margin-bottom:12px; }
.question { margin:14px 0; padding:12px; border-radius:8px; background:#fbfdff; border:1px solid #e6eef9; }
.question p { margin:0 0 8px 0; text-align:justify; }
.options label { display:block; margin:6px 0; cursor:pointer; padding-left:6px; }
.options label > input { margin-right:8px; vertical-align:middle; }
input[type="radio"] { accent-color: #007bff; }
.label-correct { color: #2a9d2a; font-weight:700; }
.label-wrong { color: #c0392b; font-weight:700; }
.explanation { display:none; margin-top:10px; padding:10px; background:#f4f8ff; border-left:4px solid #007bff; border-radius:6px; color:#1b2b4a; text-align:justify; }
.feedback { margin-top:8px; font-weight:700; }
.controls { margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
.controls button { padding:10px 14px; border-radius:8px; border:none; cursor:pointer; color:white; background:#007bff; }
.controls button.secondary { background:#6c757d; }
.controls button.reset { background:#dc3545; }
.checkBtn { margin-top:8px; padding:8px 10px; border-radius:6px; border:none; background:#0b79d0; color:#fff; cursor:pointer; display:none; }
.checkBtn:disabled { opacity:.6; cursor:not-allowed; }
@media (max-width:520px){
  .container { padding:12px; }
  .controls { flex-direction:column; align-items:stretch; }
}
</style>
</head>
<body>
<div class="container">
  <h1>📘 Dynamic English A — Unit 1: Multiple Choice Section B</h1>
  <div id="quizForm"></div>
  <div class="controls">
    <button id="submitBtn">Submit</button>
    <button id="resetBtn" class="reset">Reset</button>
    <button id="backBtn" class="secondary" onclick="location.href='../multiple-choice.html'">⬅ Back</button>
    <div id="status" style="margin-left:auto;color:#555;font-weight:600"></div>
  </div>
</div>

<script>
const questions = [
  { text: "Factories and power plants release large amounts of greenhouse gas emissions, which are the primary cause of:",
    options: ["global warming and climate change","increased biodiversity in ecosystems","the purification of the air we breathe"], correct: 0,
    explanation: "Greenhouse gas emissions trap heat and drive climate change." },
  { text: "The primary cause of biodiversity loss worldwide is:",
    options: ["habitat destruction due to human activities","an increase in national parks and protected areas","the natural evolution of species"], correct: 0,
    explanation: "Habitat destruction by humans is the main driver of biodiversity loss." },
  { text: "The old chemical plant was shut down after it was discovered to be leaking toxic waste into the ground. This dangerous material:",
    options: ["can be safely disposed of in any local bin","poses a serious risk to human and environmental health","is beneficial for plant growth"], correct: 1,
    explanation: "Toxic waste can contaminate soil, water, and air, harming health and environment." },
  { text: "Most of our non-recycled household trash ends up in landfill sites, which are:",
    options: ["specialized facilities for burning waste for energy","areas of land where waste is buried and accumulates","centers for sorting and recycling materials"], correct: 1,
    explanation: "Landfills are areas where waste is buried, leading to accumulation and potential pollution." },
  { text: "The farmers couldn't grow crops because of the soil contamination from the nearby industrial site. This means the soil was:",
    options: ["very fertile and rich in nutrients","polluted with harmful substances","perfectly safe for agriculture"], correct: 1,
    explanation: "Soil contamination makes land unsuitable for farming and can be dangerous for health." }
];

const STORAGE_KEY = "unit1A_mcq_sectionB";
let savedState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || { answers: [], submitted: false, checked: {} };
const form = document.getElementById("quizForm");

questions.forEach((q,i) => {
  const wrapper = document.createElement("div");
  wrapper.className = "question";
  wrapper.id = `question-${i}`;
  let html = `<p>${i+1}. ${q.text}</p><div class="options" role="radiogroup">`;
  q.options.forEach((opt, idx) => {
    const isChecked = (savedState.answers && savedState.answers[i]===idx) ? "checked" : "";
    const disabled = savedState.submitted ? "disabled" : "";
    html += `<label><input type="radio" name="q${i}" value="${idx}" ${isChecked} ${disabled}> ${String.fromCharCode(65+idx)}. ${opt}</label>`;
  });
  html += `</div><div class="feedback" id="feedback-${i}"></div>
  <div class="explanation" id="explanation-${i}">${q.explanation}</div>
  <button type="button" class="checkBtn" data-index="${i}">Check</button>`;
  wrapper.innerHTML = html;
  form.appendChild(wrapper);
});

const submitBtn = document.getElementById("submitBtn");
const resetBtn = document.getElementById("resetBtn");
const statusDiv = document.getElementById("status");

function showCheckButtons(show){
  document.querySelectorAll(".checkBtn").forEach(btn => btn.style.display = show?"inline-block":"none");
}

if(savedState.submitted){
  document.querySelectorAll("input[type=radio]").forEach(r=>r.disabled=true);
  showCheckButtons(true);
  submitBtn.disabled=true;
  statusDiv.textContent = "Submitted — use Check buttons to reveal answers";
}

submitBtn.addEventListener("click", () => {
  const answers = [];
  const unanswered = [];
  questions.forEach((_, i)=>{
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    if(!sel) unanswered.push(i+1);
    else answers[i]=parseInt(sel.value);
  });
  if(unanswered.length>0){ alert("Please answer all questions: "+unanswered.join(", ")); return; }
  savedState.answers = answers;
  savedState.submitted = true;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(savedState));
  document.querySelectorAll("input[type=radio]").forEach(r=>r.disabled=true);
  showCheckButtons(true);
  submitBtn.disabled=true;
  statusDiv.textContent = "Submitted — press a Check button for each question to reveal result";
});

resetBtn.addEventListener("click", () => {
  if(!confirm("Reset your answers for this quiz?")) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

function launchConfetti(){
  const c=document.createElement("div");
  c.style.position="fixed";c.style.left=0;c.style.top=0;c.style.width="100%";c.style.height="100%";c.style.pointerEvents="none";c.style.zIndex=9999;
  document.body.appendChild(c);
  for(let i=0;i<25;i++){
    const piece=document.createElement("div");
    piece.style.position="absolute";piece.style.width="8px";piece.style.height="8px";piece.style.borderRadius="2px";
    piece.style.left=(Math.random()*100)+"%";piece.style.top="-5%";
    piece.style.background=`hsl(${Math.floor(Math.random()*360)} 80% 60%)`;
    piece.style.opacity="0.95";piece.style.transform="translateY(0)";
    piece.style.transition=`transform ${1.2+Math.random()}s linear, opacity 1.2s linear`;
    c.appendChild(piece);
    setTimeout(()=>{ piece.style.transform=`translateY(${120+Math.random()*60}vh) rotate(${Math.random()*720}deg)`; piece.style.opacity="0"; },20);
    setTimeout(()=>piece.remove(),1800);
  }
  setTimeout(()=>c.remove(),2000);
}

async function handleCheck(i){
  const answerIndex = savedState.answers && typeof savedState.answers[i]!=="undefined" ? savedState.answers[i] : (()=>{ const sel=document.querySelector(`input[name="q${i}"]:checked`); return sel?parseInt(sel.value):null; })();
  const correctIndex = questions[i].correct;
  const feedbackEl = document.getElementById(`feedback-${i}`);
  const explanationEl = document.getElementById(`explanation-${i}`);
  const labels = document.querySelectorAll(`#question-${i} .options label`);
  labels.forEach((lab, idx)=>{ lab.classList.remove("label-correct","label-wrong"); lab.style.fontWeight="normal"; });
  if(answerIndex===null){ feedbackEl.textContent="No answer selected."; return; }
  if(answerIndex===correctIndex){
    labels[answerIndex].classList.add("label-correct"); labels[answerIndex].style.fontWeight="700";
    feedbackEl.textContent="✅ Correct!"; launchConfetti();
  } else {
    labels[answerIndex].classList.add("label-wrong"); labels[answerIndex].style.fontWeight="700";
    labels[correctIndex].classList.add("label-correct"); labels[correctIndex].style.fontWeight="700";
    feedbackEl.textContent="❌ Wrong";
  }
  explanationEl.style.display="block";
  savedState.checked = savedState.checked || {}; savedState.checked[i]=true;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(savedState));
}

document.querySelectorAll(".checkBtn").forEach(btn=>{
  btn.addEventListener("click",(e)=>{
    const idx=parseInt(e.currentTarget.dataset.index); e.currentTarget.disabled=true; handleCheck(idx);
  });
});

if(savedState.submitted){
  showCheckButtons(true);
  document.querySelectorAll(".checkBtn").forEach(btn=>{
    const idx=parseInt(btn.dataset.index);
    btn.style.display="inline-block";
    if(savedState.checked && savedState.checked[idx]){ btn.disabled=true; handleCheck(idx); }
    else btn.disabled=false;
  });
}
</script>
</body>
</html>