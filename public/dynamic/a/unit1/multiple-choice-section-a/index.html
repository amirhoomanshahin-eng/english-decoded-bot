<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dynamic English A - Unit 1 (Multiple Choice — Section A)</title>
<link rel="stylesheet" href="../../../../style.css">
<style>
/* exact visual style matching Dynamic B Unit 1 + bold questions */
body { font-family: "Segoe UI", Arial, sans-serif; padding:18px; background:linear-gradient(#f6f8fb,#ffffff); color:#111; }
.container { max-width:920px; margin:0 auto; background:rgba(255,255,255,0.95); padding:18px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06); }
h1 { text-align:center; margin-bottom:12px; }
.question { margin:14px 0; padding:12px; border-radius:8px; background:#fbfdff; border:1px solid #e6eef9; }
.question p { margin:0 0 8px 0; text-align:justify; font-weight:700; } /* bold questions */
.options label { display:block; margin:6px 0; cursor:pointer; padding-left:6px; }
.options label > input { margin-right:8px; vertical-align:middle; }
input[type="radio"] { accent-color: #007bff; }
.label-correct { color: #2a9d2a; font-weight:700; }
.label-wrong { color: #c0392b; font-weight:700; }
.explanation { display:none; margin-top:10px; padding:10px; background:#f4f8ff; border-left:4px solid #007bff; border-radius:6px; color:#1b2b4a; text-align:justify; }
.feedback { margin-top:8px; font-weight:700; }
.controls { margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
.controls button { padding:10px 14px; border-radius:8px; border:none; cursor:pointer; color:white; background:#007bff; }
.controls button.secondary { background:#6c757d; }
.controls button.reset { background:#dc3545; }
.checkBtn { margin-top:8px; padding:8px 10px; border-radius:6px; border:none; background:#0b79d0; color:#fff; cursor:pointer; display:none; }
.checkBtn:disabled { opacity:.6; cursor:not-allowed; }
@media (max-width:520px){
  .container { padding:12px; }
  .controls { flex-direction:column; align-items:stretch; }
}
</style>
</head>
<body>
  <div class="container">
    <h1>📘 Dynamic English A — Unit 1</h1>
    <h2 style="text-align:center; margin-top:0; margin-bottom:14px">Multiple Choice — Section A (Questions 1–5)</h2>

    <div id="quizForm"></div>

    <div class="controls">
      <button id="submitBtn">Submit</button>
      <button id="resetBtn" class="reset">Reset</button>
      <button id="backBtn" class="secondary" onclick="location.href='../multiple-choice.html'">⬅ Back</button>
      <div id="status" style="margin-left:auto;color:#555;font-weight:600"></div>
    </div>
  </div>

  <audio id="correctSound" src="../../../../sounds/correct.mp3"></audio>
  <audio id="wrongSound" src="../../../../sounds/wrong.mp3"></audio>

<script>
/* SECTION A: Questions 1–5 (environment vocabulary) */
const questions = [
  {
    text: "The government is investing in solar and wind power to reduce the use of fossil fuels. This is an example of:",
    options: ["environmental degradation","climate change mitigation","ocean acidification"],
    correct: 1,
    explanation: "Climate change mitigation — actions that reduce greenhouse gas emissions, like switching to renewables."
  },
  {
    text: "One way to lower your personal carbon footprint is to:",
    options: ["use reusable bags instead of plastic ones.","separate your glass and paper for recycling.","drive a car to work alone instead of taking public transport."],
    correct: 0,
    explanation: "Using reusable bags reduces demand for single-use plastics and the emissions that result from their production and disposal."
  },
  {
    text: "When the ocean absorbs too much CO₂ from the atmosphere, it becomes more acidic, harming coral and shellfish. This process is known as:",
    options: ["soil contamination","ocean acidification","toxic waste"],
    correct: 1,
    explanation: "Ocean acidification — CO₂ dissolves in seawater and lowers pH, harming marine organisms with shells."
  },
  {
    text: "The clearing of vast areas of the Amazon rainforest is a major cause of deforestation, which leads to:",
    options: ["an increase in greenhouse gas emissions.","a cleaner atmosphere.","more oxygen being produced."],
    correct: 0,
    explanation: "Deforestation releases carbon stored in trees and reduces the planet's capacity to absorb CO₂."
  },
  {
    text: "The building of a new factory on the edge of town has caused environmental degradation in the area, meaning the local environment has:",
    options: ["become healthier and more diverse.","been improved and protected.","been significantly damaged and polluted."],
    correct: 2,
    explanation: "Environmental degradation indicates deterioration of the environment through pollution or destruction."
  }
];

const STORAGE_KEY = "unit1A_mcq_sectionA_v2";
let savedState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || { answers: [], submitted: false, checked: {} };
const form = document.getElementById("quizForm");

function renderQuestions() {
  form.innerHTML = "";
  questions.forEach((q, i) => {
    const wrapper = document.createElement("div");
    wrapper.className = "question";
    wrapper.id = `question-${i}`;

    let html = `<p>${i+1}. ${q.text}</p><div class="options" role="radiogroup">`;
    q.options.forEach((opt, idx) => {
      const isChecked = (savedState.answers && savedState.answers[i] === idx) ? "checked" : "";
      const disabled = savedState.submitted ? "disabled" : "";
      html += `<label><input type="radio" name="q${i}" value="${idx}" ${isChecked} ${disabled}> ${String.fromCharCode(65+idx)}. ${opt}</label>`;
    });
    html += `</div>
      <div class="feedback" id="feedback-${i}"></div>
      <div class="explanation" id="explanation-${i}">${q.explanation}</div>
      <button type="button" class="checkBtn" data-index="${i}">Check</button>`;
    wrapper.innerHTML = html;
    form.appendChild(wrapper);
  });
}

renderQuestions();

/* UI elements */
const submitBtn = document.getElementById("submitBtn");
const resetBtn = document.getElementById("resetBtn");
const statusDiv = document.getElementById("status");
const correctSound = document.getElementById("correctSound");
const wrongSound = document.getElementById("wrongSound");

function showCheckButtons(show){
  document.querySelectorAll(".checkBtn").forEach(btn => btn.style.display = show ? "inline-block" : "none");
}

/* Restore UI if previously submitted */
if (savedState.submitted) {
  document.querySelectorAll("input[type=radio]").forEach(r => r.disabled = true);
  showCheckButtons(true);
  submitBtn.disabled = true;
  statusDiv.textContent = "Submitted — use Check buttons to reveal answers";
}

/* Submit handler */
submitBtn.addEventListener("click", () => {
  const answers = [];
  const unanswered = [];
  questions.forEach((_, i) => {
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    if (!sel) unanswered.push(i+1);
    else answers[i] = parseInt(sel.value, 10);
  });

  if (unanswered.length > 0) {
    alert("Please answer all questions: " + unanswered.join(", "));
    return;
  }

  savedState.answers = answers;
  savedState.submitted = true;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(savedState));

  document.querySelectorAll("input[type=radio]").forEach(r => r.disabled = true);
  showCheckButtons(true);
  submitBtn.disabled = true;
  statusDiv.textContent = "Submitted — press a Check button for each question to reveal result";
});

/* Reset handler */
resetBtn.addEventListener("click", () => {
  if (!confirm("Reset your answers for this quiz?")) return;
  localStorage.removeItem(STORAGE_KEY);
  savedState = { answers: [], submitted: false, checked: {} };
  renderQuestions();
  submitBtn.disabled = false;
  statusDiv.textContent = "";
});

/* Confetti (lightweight) */
function launchConfetti(){
  const c = document.createElement("div");
  c.style.position = "fixed"; c.style.left = 0; c.style.top = 0; c.style.width = "100%"; c.style.height = "100%";
  c.style.pointerEvents = "none"; c.style.zIndex = 9999;
  document.body.appendChild(c);
  for (let i=0;i<25;i++){
    const piece = document.createElement("div");
    piece.style.position="absolute";
    piece.style.width="8px"; piece.style.height="8px"; piece.style.borderRadius="2px";
    piece.style.left = (Math.random()*100) + "%";
    piece.style.top = "-5%";
    piece.style.background = `hsl(${Math.floor(Math.random()*360)} 80% 60%)`;
    piece.style.opacity = "0.95";
    piece.style.transition = `transform ${1.2+Math.random()}s linear, opacity 1.2s linear`;
    c.appendChild(piece);
    setTimeout(()=> {
      piece.style.transform = `translateY(${120+Math.random()*60}vh) rotate(${Math.random()*720}deg)`;
      piece.style.opacity = "0";
    }, 20);
    setTimeout(()=> piece.remove(), 1800);
  }
  setTimeout(()=> c.remove(), 2000);
}

/* Check button handling */
async function handleCheck(i){
  const answerIndex = (savedState.answers && typeof savedState.answers[i] !== "undefined") ? savedState.answers[i] : (() => {
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    return sel ? parseInt(sel.value, 10) : null;
  })();

  const correctIndex = questions[i].correct;
  const feedbackEl = document.getElementById(`feedback-${i}`);
  const explanationEl = document.getElementById(`explanation-${i}`);
  const labels = document.querySelectorAll(`#question-${i} .options label`);

  // clear previous styles
  labels.forEach((lab) => {
    lab.classList.remove("label-correct", "label-wrong");
    lab.style.fontWeight = "normal";
  });

  if (answerIndex === null) {
    feedbackEl.textContent = "No answer selected.";
    return;
  }

  if (answerIndex === correctIndex) {
    labels[answerIndex].classList.add("label-correct");
    labels[answerIndex].style.fontWeight = "700";
    feedbackEl.textContent = "✅ Correct!";
    try { correctSound.currentTime = 0; correctSound.play(); } catch(e){}
    launchConfetti();
  } else {
    labels[answerIndex].classList.add("label-wrong");
    labels[answerIndex].style.fontWeight = "700";
    labels[correctIndex].classList.add("label-correct");
    labels[correctIndex].style.fontWeight = "700";
    feedbackEl.textContent = "❌ Wrong";
    try { wrongSound.currentTime = 0; wrongSound.play(); } catch(e){}
  }

  explanationEl.style.display = "block";

  savedState.checked = savedState.checked || {};
  savedState.checked[i] = true;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(savedState));
}

/* Attach check button listeners (use event delegation for newly-rendered elements after reset) */
function attachCheckListeners(){
  document.querySelectorAll(".checkBtn").forEach(btn => {
    btn.removeEventListener("click", btn._listener);
    btn._listener = (e) => {
      const idx = parseInt(e.currentTarget.dataset.index, 10);
      e.currentTarget.disabled = true;
      handleCheck(idx);
    };
    btn.addEventListener("click", btn._listener);
  });
}

/* initial attach */
attachCheckListeners();

/* Restore checked state if existed */
if (savedState.submitted) {
  showCheckButtons(true);
  document.querySelectorAll(".checkBtn").forEach(btn=>{
    const idx = parseInt(btn.dataset.index, 10);
    btn.style.display = "inline-block";
    if (savedState.checked && savedState.checked[idx]) {
      btn.disabled = true;
      handleCheck(idx);
    } else {
      btn.disabled = false;
    }
  });
}

/* ensure that after reset (which re-renders) listeners are re-attached */
const observer = new MutationObserver(()=> attachCheckListeners());
observer.observe(form, { childList: true, subtree: true });
</script>
</body>
</html>